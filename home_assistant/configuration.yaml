# Configure a default setup of Home Assistant (frontend, api, etc)
default_config:

alert: !include alerts.yaml
# https://community.home-assistant.io/t/how-do-i-mix-manual-automations-in-yaml-files-with-use-of-blueprints/295730
automation: !include automations.yaml
binary_sensor: !include binary_sensors.yaml
camera: !include cameras.yaml
cover: !include covers.yaml
group: !include groups.yaml
homekit: !include homekit.yaml
input_boolean: !include input_booleans.yaml
input_datetime: !include input_datetimes.yaml
input_number: !include input_numbers.yaml
input_select: !include input_selects.yaml
light: !include lights.yaml
media_player: !include media_players.yaml
mqtt: !include mqtt.yaml
multiscrape: !include multiscrape.yaml
rest: !include rest.yaml
scene: !include scenes.yaml
script: !include scripts.yaml
sensor: !include sensors.yaml
shell_command: !include shell_commands.yaml
switch: !include switches.yaml
template: !include template_sensors.yaml
timer: !include timers.yaml
utility_meter: !include utility_meters.yaml

# https://www.home-assistant.io/docs/configuration/basic/
homeassistant:
  name: Home
  latitude: !secret home_latitude
  longitude: !secret home_longitude
  elevation: !secret home_elevation
  country: ZA
  unit_system: metric
  time_zone: "Africa/Johannesburg"
  currency: ZAR
  allowlist_external_dirs:
    - /tmp
    - /mnt/nas/Backups/home_assistant/
    - /sys/class/power_supply/
    - /home/homeassistant/.homeassistant/downloads
  media_dirs:
    gallery: /home/homeassistant/.homeassistant/www/gallery
  customize: !include customize.yaml
  # https://www.home-assistant.io/docs/configuration/packages/
  packages: !include_dir_named packages

logger:
  default: warning
  # logs:
  #   homeassistant.components.template.weather: debug
  #   homeassistant.components.openuv: debug
  #   homeassistant.components.tplink: debug
  #   homeassistant.components.shell_command: debug
  #   homeassistant.components.linux_battery: debug
  #   homeassistant.components.automation: info
  #   homeassistant.components.python_script: debug
  #   custom_components.shairport_sync: debug
  #   custom_components.multiscrape: debug

lovelace:
  mode: yaml
  resources:
    # hacs
    - url: /hacsfiles/button-card/button-card.js
      type: module
    - url: /hacsfiles/lovelace-fold-entity-row/fold-entity-row.js
      type: module
    - url: /hacsfiles/mini-graph-card/mini-graph-card-bundle.js
      type: module
    - url: /hacsfiles/mini-media-player/mini-media-player-bundle.js
      type: module
    - url: /hacsfiles/weather-card/weather-card.js
      type: module
    - url: /hacsfiles/gallery-card/gallery-card.js
      type: module
    - url: /hacsfiles/apexcharts-card/apexcharts-card.js
      type: module
    - url: /hacsfiles/ha-floorplan/floorplan.js
      type: module
    - url: /hacsfiles/lovelace-state-switch/state-switch.js
      type: module
    - url: /hacsfiles/timer-bar-card/timer-bar-card.js
      type: module
    - url: /hacsfiles/atomic-calendar-revive/atomic-calendar-revive.js
      type: module
    - url: /hacsfiles/lovelace-multiple-entity-row/multiple-entity-row.js
      type: module
    - url: /hacsfiles/swipe-card/swipe-card.js
      type: module
    - url: /hacsfiles/battery-state-card/battery-state-card.js
      type: module
    - url: /hacsfiles/lovelace-hourly-weather/hourly-weather.js
      type: module
    - url: /hacsfiles/history-explorer-card/history-explorer-card.js
      type: module
    - url: /hacsfiles/power-flow-card/power-flow-card.js
      type: module
    # manual
    - url: /local/floorplan/floorplan-card.js
      type: module
    - url: /local/weather-card-chart/weather-card-chart.js
      type: module

frontend:
  themes: !include_dir_merge_named themes
  extra_module_url:
    - /local/custom.js
    - /local/panel-redirect.js
    - /hacsfiles/lovelace-card-mod/card-mod.js

# https://community.home-assistant.io/t/2022-5-streamlining-settings/418477/96
panel_custom:
  - name: panel-redirect
    url_path: redirect-server-controls
    sidebar_title: Server Controls
    sidebar_icon: mdi:server
    module_url: /local/panel-redirect.js
    config:
      target: /developer-tools/yaml
  - name: panel-redirect
    url_path: redirect-entities
    sidebar_title: Entities
    sidebar_icon: mdi:format-list-bulleted
    module_url: /local/panel-redirect.js
    config:
      target: /config/entities
  - name: panel-redirect
    url_path: redirect-logs
    sidebar_title: Logs
    sidebar_icon: mdi:math-log
    module_url: /local/panel-redirect.js
    config:
      target: /config/logs
  - name: panel-redirect
    url_path: redirect-integrations
    sidebar_title: Integrations
    sidebar_icon: mdi:apps-box
    module_url: /local/panel-redirect.js
    config:
      target: /config/integrations
  - name: panel-redirect
    url_path: redirect-automations
    sidebar_title: Automations
    sidebar_icon: mdi:autorenew
    module_url: /local/panel-redirect.js
    config:
      target: /config/automation/dashboard

recorder:
  db_url: postgresql://@/homeassistant
  # https://community.home-assistant.io/t/home-assistant-db-size/1198/10?u=parautenbach
  # If you set it for 14 days, then it runs after 14 days of UNINTERRUPTED uptime. If you restart your HA server, then the clock restarts from zero again.
  # delete from events where time_fired < datetime('now','-30 days');
  # delete from states where created < datetime('now', '-30 days');
  # SQLite does not recover the disk space after you have done this, so it is necessary to ‘vacuum’ the database. Simply issue the following command:
  # vacuum;
  auto_purge: true
  purge_keep_days: 7

tts:
  - platform: google_translate

zone:
  - name: Home
    latitude: !secret home_latitude
    longitude: !secret home_longitude
    radius: 22
    icon: mdi:home

proximity:
  home:  # this refers to zone.home
    zone: home
    devices:
      - device_tracker.ceres
    tolerance: 20
    unit_of_measurement: m

notify:
  - name: family
    platform: group
    services:
      - service: mobile_app_ceres
      - service: mobile_app_rouve

apple_tv:

discovery:

ios:

media_source:

python_script:

stream:

# https://www.dahuasecurity.com/products/All-Products/Video-Intercoms/IP-Products/Door-Stations/VTO2211G-WP
# https://amcrest.com/smarthome-2-megapixel-wireless-doorbell-security-camera-1920-x-1080p-wifi-doorbell-camera-ip55-weatherproof-two-way-audio-ad110.html
# https://www.hikvision.com/en/products/Video-Intercom-Products/
# https://github.com/rroller/dahua
# https://community.home-assistant.io/t/amcrest-doorbell-ad110-api-local-only/223838
# https://community.home-assistant.io/t/dahua-vto-custom-integration/293693
amcrest:
  - name: Doorbell
    host: !secret doorbell_host
    username: !secret doorbell_username
    password: !secret doorbell_password
    binary_sensors:
      - motion_detected
      - online

# https://community.home-assistant.io/t/control-recursion-in-the-folder-watcher-integration/200110
# folder_watcher:
#   - folder: /tmp/
#     patterns:
#       - 'camera.security_camera_*.jpg'

weather:
  # https://community.home-assistant.io/t/mapping-weather-conditions-in-the-ui/289207
  - platform: template
    name: "Forecast Tomorrow"
    condition_template: "{{ state_attr('weather.openweathermap_daily', 'forecast')[1]['condition'] }}"
    temperature_template: "{{ state_attr('weather.openweathermap_daily', 'forecast')[1]['temperature'] }}"
    temperature_unit: "°C"
    # workaround: https://github.com/home-assistant/core/issues/91620
    humidity_template: "{{ 0.0 | float(0) }}"
    pressure_template: "{{ state_attr('weather.openweathermap_daily', 'forecast')[1]['pressure'] }}"
    pressure_unit: "hPa"
    wind_speed_template: "{{ state_attr('weather.openweathermap_daily', 'forecast')[1]['wind_speed'] }}"
    wind_speed_unit: "km/h"
    wind_bearing_template: "{{ state_attr('weather.openweathermap_daily', 'forecast')[1]['wind_bearing'] }}"
    precipitation_unit: "mm"
    # forecast_template: "{{ state_attr('weather.openweathermap_daily', 'forecast')[1:] }}"
    attribution_template: "{{ state_attr('weather.openweathermap_daily', 'attribution') }}"
