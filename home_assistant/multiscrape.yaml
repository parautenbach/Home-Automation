- resource: https://pollencount.co.za/
  scan_interval: 21600  # 60*60*6 or 4 updates per day
  timeout: 30
  sensor:
    - name: Overall Pollen Risk
      icon: mdi:flower-pollen-outline
      select: "#wpv-view-layout-300 > div > div > div.image-resize > div:nth-child(2) > div:nth-child(2) > div"
      attribute: "class"
      value_template: >-
        {# set value = ["pollen-darkorange"] #}
        {%- from 'pollen.jinja' import color_level_map -%}
        {%- set key = value | first -%}
        {{ color_level_map[key] if key in color_level_map else "unknown" }}
      on_error:
        value: last
      attributes:
        - name: Label
          select: "#wpv-view-layout-300 > div > div > div.image-resize > div:nth-child(2) > div:nth-child(2) > div"
          attribute: "class"
          value_template: >-
            {%- from 'pollen.jinja' import color_label_map -%}
            {%- set key = value | first -%}
            {{ color_label_map[key] if key in color_label_map else "Unavailable" }}
          on_error:
            value: last
        # this looks like massive duplication, but we want attributes here so that we can trigger on state
        # changes of this sensor if an individual pollen level has changed. we need the individual sensors
        # so that we can set a name and an icon for use on dashboards. granted, we can make these normal
        # template sensors that extracts the attributes from here.
        - name: Tree Pollen
          select: "#wpv-view-layout-300 > div > div > div.image-resize > div:nth-child(2) > div:nth-child(3) > div"
          attribute: "class"
          value_template: >-
            {%- from 'pollen.jinja' import color_level_map -%}
            {%- set key = value | first -%}
            {{ color_level_map[key] if key in color_level_map else "unknown" }}
          on_error:
            value: last
        - name: Grass Pollen
          select: "#wpv-view-layout-300 > div > div > div.image-resize > div:nth-child(2) > div:nth-child(4) > div"
          attribute: "class"
          value_template: >-
            {%- from 'pollen.jinja' import color_level_map -%}
            {%- set key = value | first -%}
            {{ color_level_map[key] if key in color_level_map else "unknown" }}
          on_error:
            value: last
        - name: Weed Pollen
          select: "#wpv-view-layout-300 > div > div > div.image-resize > div:nth-child(2) > div:nth-child(5) > div"
          attribute: "class"
          value_template: >-
            {%- from 'pollen.jinja' import color_level_map -%}
            {%- set key = value | first -%}
            {{ color_level_map[key] if key in color_level_map else "unknown" }}
          on_error:
            value: last
        - name: Mould Spores
          select: "#wpv-view-layout-300 > div > div > div.image-resize > div:nth-child(2) > div:nth-child(6) > div"
          attribute: "class"
          value_template: >-
            {%- from 'pollen.jinja' import color_level_map -%}
            {%- set key = value | first -%}
            {{ color_level_map[key] if key in color_level_map else "unknown" }}
          on_error:
            value: last
    - name: Tree Pollen
      icon: mdi:pine-tree
      select: "#wpv-view-layout-300 > div > div > div.image-resize > div:nth-child(2) > div:nth-child(3) > div"
      attribute: "class"
      value_template: >-
        {%- from 'pollen.jinja' import color_level_map -%}
        {%- set key = value | first -%}
        {{ color_level_map[key] if key in color_level_map else "unknown" }}
      on_error:
        value: last
      attributes:
        - name: Label
          select: "#wpv-view-layout-300 > div > div > div.image-resize > div:nth-child(2) > div:nth-child(3) > div"
          attribute: "class"
          value_template: >-
            {%- from 'pollen.jinja' import color_label_map -%}
            {%- set key = value | first -%}
            {{ color_label_map[key] if key in color_label_map else "Unavailable" }}
          on_error:
            value: last
    - name: Grass Pollen
      icon: mdi:grass
      select: "#wpv-view-layout-300 > div > div > div.image-resize > div:nth-child(2) > div:nth-child(4) > div"
      attribute: "class"
      value_template: >-
        {%- from 'pollen.jinja' import color_level_map -%}
        {%- set key = value | first -%}
        {{ color_level_map[key] if key in color_level_map else "unknown" }}
      on_error:
        value: last
      attributes:
        - name: Label
          select: "#wpv-view-layout-300 > div > div > div.image-resize > div:nth-child(2) > div:nth-child(4) > div"
          attribute: "class"
          value_template: >-
            {%- from 'pollen.jinja' import color_label_map -%}
            {%- set key = value | first -%}
            {{ color_label_map[key] if key in color_label_map else "Unavailable" }}
          on_error:
            value: last
    - name: Weed Pollen
      icon: mdi:sprout
      select: "#wpv-view-layout-300 > div > div > div.image-resize > div:nth-child(2) > div:nth-child(5) > div"
      attribute: "class"
      value_template: >-
        {%- from 'pollen.jinja' import color_level_map -%}
        {%- set key = value | first -%}
        {{ color_level_map[key] if key in color_level_map else "unknown" }}
      on_error:
        value: last
      attributes:
        - name: Label
          select: "#wpv-view-layout-300 > div > div > div.image-resize > div:nth-child(2) > div:nth-child(5) > div"
          attribute: "class"
          value_template: >-
            {%- from 'pollen.jinja' import color_label_map -%}
            {%- set key = value | first -%}
            {{ color_label_map[key] if key in color_label_map else "Unavailable" }}
          on_error:
            value: last
    - name: Mould Spores
      icon: mdi:grain
      select: "#wpv-view-layout-300 > div > div > div.image-resize > div:nth-child(2) > div:nth-child(6) > div"
      attribute: "class"
      value_template: >-
        {%- from 'pollen.jinja' import color_level_map -%}
        {%- set key = value | first -%}
        {{ color_level_map[key] if key in color_level_map else "unknown" }}
      on_error:
        value: last
      attributes:
        - name: Label
          select: "#wpv-view-layout-300 > div > div > div.image-resize > div:nth-child(2) > div:nth-child(6) > div"
          attribute: "class"
          value_template: >-
            {%- from 'pollen.jinja' import color_label_map -%}
            {%- set key = value | first -%}
            {{ color_label_map[key] if key in color_label_map else "Unavailable" }}
          on_error:
            value: last
